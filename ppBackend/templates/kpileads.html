{% extends 'index.html' %}


{% block scripthead %}
<link href="{{ url_for('static', filename='plugins/bootstrap-daterangepicker/daterangepicker.css') }}" rel="stylesheet" type="text/css" />
<link href="{{ url_for('static', filename='plugins/datatables/select.dataTables.min.css') }}" rel="stylesheet" type="text/css" />

<script>
  response_code = parseInt("{{response_code}}")
  response_message = "{{response_message}}"
  console.log({{ response_data| tojson}})
  {% if response_code == 200 %}
  sessionStorage.setItem("leadsObj", '{{response_data|tojson}}')
  // document.location = "/home"
  {% else %}
  console.log({{ response_data| tojson}})
  {% endif %}
  const leadsObj = {{ response_data| tojson}}


</script>
{% endblock %}

{% block content %}
<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="content-page">
  <!-- Start content -->
  <div class="content">
    <div class="container">
      <div class="row">
        <div class="col-xs-12">
          <div class="page-title-box">
            <h4 class="page-title">View Leads</h4>
            <div class="clearfix"></div>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="table-responsive">
              <div class="card-box table-responsive">
                <table id="datatable" class="table table-striped table-bordered">
                  <thead>
                    <tr>
                      <th style="width: 85px;">ID</th>
                      <th style="width: 85px;">Name</th>
                      <th style="width: 85px;">Assigned to</th>
                      <th style="width: 85px;">Last Work</th>
                      <th style="width: 85px;">Project</th>
                      <th style="width: 85px;">Level</th>
                      <th style="width: 85px;">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="lead-detail">
                    {% for obj in response_data %}
                    <tr>
                      <td scope="row">
                        <div>{{obj.lead_id}}</div>
                        <div>
                            <p>{{obj.created_on}}</p>
                        </div>
                      </td>
                      <td>{{obj.first_name}}</td>
                      <td>{{obj.user.name}}</td>
                      {% if 'followup' in obj %}
                      <td><p>{{obj.followup.sub_type}}</p>
                        <p>{{obj.followup.created_on}}</p></td>
                      {% else %}
                      <td></td>
                      {% endif %}
                      <td>{{obj.project}}</td>
                      <td>{{obj.lead_level}}</td>
                      <td>
                        {% if 'followup' in obj %}
                        <a href="/api/follow_ups/follow_read?lead={{obj._id}}" target="_blank" type="button" data-toggle="tooltip" data-placement="left" title="{{obj.followup.comment}}" 
                              data-original-title="{{obj.followup.comment}}"><i class="mdi mdi-comment-outline"></i></a>
                        TLW: {{obj.followup.follow_count}}
                        {% else %}
                        TLW: 0
                        {% endif %}
                        <a href="/api/follow_ups/create?lead={{obj._id}}"><i
                              class="glyphicon glyphicon-plus"></i></a></p>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div> <!-- end col -->
      </div>
      <!-- end row -->
    </div> <!-- container -->

  </div> <!-- content -->

</div>


<!-- ============================================================== -->
<!-- End Right content here -->
<!-- ============================================================== -->

{% endblock %}

{% block scriptfooter %}

<script src="{{ url_for('static', filename='plugins/datatables/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.bootstrap.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.buttons.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/buttons.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/jszip.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/pdfmake.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/vfs_fonts.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/buttons.html5.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/buttons.print.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.fixedHeader.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.keyTable.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.responsive.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/responsive.bootstrap.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.scroller.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.colVis.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.fixedColumns.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatables/dataTables.select.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/bootstrap-daterangepicker/daterangepicker.js') }}"></script>

<!-- init -->
<script src="{{ url_for('static', filename='pages/jquery.datatables.init.js') }}"></script>
<script src="{{ url_for('static', filename='pages/jquery.form-pickers.init.js') }}"></script>

<script>
  $("table").each(function () {
    $(this).DataTable({
      "bFilter": true,
      "aaSorting": [],
      "pageLength": 100,
      select: true,
    });
  })
    // TableManageButtons.init();

</script>

{% endblock %}